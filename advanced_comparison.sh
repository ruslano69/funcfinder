#!/bin/bash

echo "========================================="
echo "–ü–†–û–î–í–ò–ù–£–¢–´–ï –°–¶–ï–ù–ê–†–ò–ò"
echo "========================================="
echo ""

# –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–∞–π—Ç–∏ –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
echo "üß™ –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–∞–π—Ç–∏ –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏"
echo "----------------------------------------"
echo "grep: –Ω–∞—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è"
grep -h "^func Test" *_test.go | wc -l
echo "—Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞–π–¥–µ–Ω–æ (grep)"
echo ""

echo "funcfinder: –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–π"
for file in *_test.go; do
    ./funcfinder --inp "$file" --source go --map 2>/dev/null | \
        grep -o "Test[^:]*" | head -3
done | head -10
echo "... (–ø–æ–∫–∞–∑–∞–Ω—ã –ø–µ—Ä–≤—ã–µ 10)"
echo ""

# –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
echo "üìä –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ? (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ)"
echo "----------------------------------------"
echo "grep: –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ"
echo ""

echo "funcfinder: –∏—Å–ø–æ–ª—å–∑—É–µ–º JSON + jq"
for file in finder.go sanitizer.go formatter.go; do
    echo "=== $file ==="
    ./funcfinder --inp "$file" --source go --map --json 2>/dev/null | \
        jq -r 'to_entries[] | "\(.key): \(.value.end - .value.start) lines"' | \
        sort -t: -k2 -rn
    echo ""
done
echo ""

# –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò–∑–≤–ª–µ—á—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è code review
echo "üëÄ –°—Ü–µ–Ω–∞—Ä–∏–π 3: Code Review - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏—é CleanLine"
echo "----------------------------------------"
echo "grep + –∫–æ–Ω—Ç–µ–∫—Å—Ç: –Ω–µ—Ç–æ—á–Ω–æ, –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –ª–∏—à–Ω–µ–µ"
echo "$ grep -A 50 'func.*CleanLine' sanitizer.go"
echo ""

echo "funcfinder: —Ç–æ—á–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã"
./funcfinder --inp sanitizer.go --source go --func CleanLine --extract | head -20
echo "..."
echo ""

# –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
echo "üîó –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –Ω–∞–π—Ç–∏ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è"
echo "----------------------------------------"
echo "–®–∞–≥ 1: funcfinder –Ω–∞—Ö–æ–¥–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é"
./funcfinder --inp finder.go --source go --func NewFinder
echo ""

echo "–®–∞–≥ 2: grep –∏—â–µ—Ç –≥–¥–µ –æ–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è"
grep -rn "NewFinder(" --include="*.go" | head -3
echo ""

# –°—Ü–µ–Ω–∞—Ä–∏–π 5: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
echo "üìà –°—Ü–µ–Ω–∞—Ä–∏–π 5: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞"
echo "----------------------------------------"
TOTAL_FUNCS=0
TOTAL_LINES=0

for file in *.go; do
    if [ -f "$file" ]; then
        JSON=$(./funcfinder --inp "$file" --source go --map --json 2>/dev/null)
        if [ -n "$JSON" ]; then
            FUNCS=$(echo "$JSON" | jq 'length' 2>/dev/null || echo 0)
            LINES=$(echo "$JSON" | jq '[.[] | .end - .start] | add' 2>/dev/null || echo 0)
            TOTAL_FUNCS=$((TOTAL_FUNCS + FUNCS))
            TOTAL_LINES=$((TOTAL_LINES + LINES))
        fi
    fi
done

echo "–í—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–π –≤ –ø—Ä–æ–µ–∫—Ç–µ: $TOTAL_FUNCS"
echo "–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö: $TOTAL_LINES"
echo "–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏: $(($TOTAL_LINES / $TOTAL_FUNCS)) —Å—Ç—Ä–æ–∫"
echo ""

echo "========================================="
echo "–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï"
echo "========================================="
echo ""
echo "grep:"
echo "  ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ —à–∞–±–ª–æ–Ω–∞–º"
echo "  ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫"
echo "  ‚ùå –ù–µ –∑–Ω–∞–µ—Ç –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–¥–∞"
echo "  ‚ùå –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä–∞–Ω–∏—Ü–∞—Ö —Ñ—É–Ω–∫—Ü–∏–π"
echo "  ‚ùå –ù–µ—Ç JSON output –¥–ª—è AI"
echo ""
echo "funcfinder:"
echo "  ‚úÖ –ü–æ–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–¥–∞ (—Å–∫–æ–±–∫–∏/–æ—Ç—Å—Ç—É–ø—ã)"
echo "  ‚úÖ –¢–æ—á–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã —Ñ—É–Ω–∫—Ü–∏–π"
echo "  ‚úÖ JSON output –¥–ª—è AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"
echo "  ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–ª —Ñ—É–Ω–∫—Ü–∏–π"
echo "  ‚úÖ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (Python)"
echo "  ‚úÖ 95%+ —ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤"
echo ""
echo "–í—ã–≤–æ–¥: grep –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ–∫—Å—Ç–∞, funcfinder –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞!"
